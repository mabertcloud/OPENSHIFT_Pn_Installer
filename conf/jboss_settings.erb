#!/bin/bash

# Calculate the memory alotted to JBOSS 40% of the (gearsize - 512)

MEMPERC=40		# Percentage of total memory for JBOSS

TOTMEM=$(awk -v tot=${OPENSHIFT_GEAR_MEMORY_MB} '
	BEGIN { print int(tot - 512) }')

MAXMXMEM=$(awk  -v perc=${MEMPERC} -v tot=${TOTMEM} '
	BEGIN { print int(tot * perc / 100) }')

JAVA_OPTS=""
JAVA_OPTS="${JAVA_OPTS} -server -Xms256m -Xmx${MAXMXMEM}m -XX:MaxPermSize=256m"
JAVA_OPTS="${JAVA_OPTS} -Dorg.jboss.resolver.warning=true"
JAVA_OPTS="${JAVA_OPTS} -Dsun.rmi.dgc.client.gcInterval=3600000"
JAVA_OPTS="${JAVA_OPTS} -Dsun.rmi.dgc.server.gcInterval=3600000"
JAVA_OPTS="${JAVA_OPTS} -Djboss.service.binding.set=ports-1"
JAVA_OPTS="${JAVA_OPTS} -Djboss.server.log.dir=<%= ENV['OPENSHIFT_PLN_DIR'] %>logs/"
JAVA_OPTS="${JAVA_OPTS} -Dlogging.configuration=file:<%= ENV['OPENSHIFT_PLN_DIR'] %>PlanonProCenter/jboss-6.1.0.Final/bin/logging.properties"
JAVA_OPTS="${JAVA_OPTS} -Dnl.planon.mail.esmtp=true"
JAVA_OPTS="${JAVA_OPTS} -da"
JAVA_OPTS="${JAVA_OPTS} -Dcom.planonsoftware.notproductionmode=true"
JAVA_OPTS="${JAVA_OPTS} -Dcom.planonsoftware.notproductionmode.description="Martijn merkes"
JAVA_OPTS="${JAVA_OPTS} -DPMFSSetting=<%= ENV['OPENSHIFT_PLN_DIR'] %>/PlanonProCenter/jboss-6.1.0.Final/server/default/conf/"
#JAVA_OPTS="${JAVA_OPTS} -DPMFS_CloudUrl=https://pmfs.planonsoftware.com/MovilizerDistributionService/"
#JAVA_OPTS="${JAVA_OPTS} -DPMFS_SystemID=<%= ENV['PLN_PMFS_ID'>"
#JAVA_OPTS="${JAVA_OPTS} -DPMFS_Password=<%= ENV['PLN_PMFS_PASSWORD'>"

export JAVA_OPTS

export LAUNCH_JBOSS_IN_BACKGROUND="TRUE"